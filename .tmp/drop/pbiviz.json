{"visual":{"name":"flatprogress","displayName":"flatprogress","guid":"pbiflatprogress111DDC2C0F0D0384236A63C11C134C5CDB5","visualClassName":"Visual","version":"1.0.0","description":"Flat progress control","supportUrl":"https://github.com/payns75/pbi_flatprogress","gitHubUrl":"https://github.com/payns75/pbi_flatprogress"},"apiVersion":"1.11.0","author":{"name":"Rémy Jacquemin","email":"rjacquemin75@gmail.com"},"assets":{"icon":"assets/icon.png"},"externalJS":["node_modules/powerbi-visuals-utils-dataviewutils/lib/index.js","d3Injector.js"],"style":"style/visual.less","capabilities":{"dataRoles":[{"displayName":"Value","name":"measure","kind":"Measure"},{"displayName":"Objectif","name":"objectif_measure","kind":"Measure"},{"displayName":"Reste à faire","name":"todo_measure","kind":"Measure"},{"displayName":"Pourcentage","name":"prct_measure","kind":"Measure"},{"displayName":"Point de Passage","name":"pt_passage_measure","kind":"Measure"}],"dataViewMappings":[{"conditions":[{"measure":{"min":1,"max":1},"objectif_measure":{"max":1},"todo_measure":{"max":1},"prct_measure":{"max":1},"pt_passage_measure":{"max":1}}],"categorical":{"values":{"select":[{"bind":{"to":"measure"}},{"bind":{"to":"objectif_measure"}},{"bind":{"to":"todo_measure"}},{"bind":{"to":"prct_measure"}},{"bind":{"to":"pt_passage_measure"}}]}}}],"objects":{"dataDisplay":{"displayName":"Data display","properties":{"backColor":{"displayName":"Back color","type":{"fill":{"solid":{"color":true}}}},"fill":{"displayName":"Fill","type":{"fill":{"solid":{"color":true}}}},"bar_height":{"displayName":"Bar height","type":{"numeric":true}},"horizontal_margin":{"displayName":"Y margin","type":{"numeric":true}},"realisation_text":{"displayName":"Réalisation Text","type":{"text":true}},"resteafaire_text":{"displayName":"A faire Text","type":{"text":true}},"ptpassage_text":{"displayName":"Pt. Passage Text","type":{"text":true}},"ptpassage_color":{"displayName":"Passage Fill","type":{"fill":{"solid":{"color":true}}}},"objectif_text":{"displayName":"Objectif Text","type":{"text":true}},"objectif_color":{"displayName":"Objectif Fill","type":{"fill":{"solid":{"color":true}}}}}},"dataOption":{"displayName":"Data option","properties":{"ptPassage":{"displayName":"Avec pt de passage","type":{"bool":true}},"prctMode":{"displayName":"Mode %","type":{"bool":true}},"prctMultiPlicateur":{"displayName":"Multi. %","type":{"bool":true}},"calculAuto":{"displayName":"Calcul auto","type":{"bool":true}}}}}},"stringResources":{},"content":{"js":"var powerbi;!function(t){var e;!function(t){var e;!function(t){var e;!function(t){var e;!function(t){function e(t,e,a){void 0===t&&(t=[]);var r=t;return i(r),e&&(r.identityFields=e),a&&(r.source=a),r}function i(t,e){t.grouped=e?function(){return e}:function(){return a(t)}}function a(t){for(var e,i=[],a=0,r=t.length;r>a;a++){var n=t[a];if(!e||e.identity!==n.identity){if(e={values:[]},n.identity){e.identity=n.identity;var s=n.source;void 0!==s.groupName?e.name=s.groupName:s.displayName&&(e.name=s.displayName)}i.push(e)}e.values.push(n)}return i}t.createValueColumns=e,t.setGrouped=i,t.groupValues=a}(e=t.DataViewTransform||(t.DataViewTransform={}))}(e=t.dataview||(t.dataview={}))}(e=t.utils||(t.utils={}))}(e=t.extensibility||(t.extensibility={}))}(powerbi||(powerbi={}));var powerbi;!function(t){var e;!function(t){var e;!function(t){var e;!function(t){var e;!function(t){function e(t,e){if(!t||!t.length)return-1;var i=t[0];if(i.values&&i.values.length>0)for(var r=0,n=i.values.length;n>r;++r){var s=i.values[r];if(s&&s.source&&a(s.source,e))return r}return-1}function i(t,e){if(t&&t.length)for(var i=0,r=t.length;r>i;i++)if(a(t[i].source,e))return i;return-1}function a(t,e){var i=t.roles;return i&&i[e]}function r(t,e){return null!=t&&null!=t.metadata&&t.metadata.columns&&t.metadata.columns.some(function(t){return t.roles&&void 0!==t.roles[e]})}function n(t,e){return t&&t.source&&t.source.roles&&t.source.roles[e]===!0}t.getMeasureIndexOfRole=e,t.getCategoryIndexOfRole=i,t.hasRole=a,t.hasRoleInDataView=r,t.hasRoleInValueColumn=n}(e=t.DataRoleHelper||(t.DataRoleHelper={}))}(e=t.dataview||(t.dataview={}))}(e=t.utils||(t.utils={}))}(e=t.extensibility||(t.extensibility={}))}(powerbi||(powerbi={}));var powerbi;!function(t){var e;!function(t){var e;!function(t){var e;!function(t){var e;!function(t){function e(t,e,i){if(!t)return i;var a=t[e];return void 0===a?i:a}function i(t,i,a){var r=e(t,i);return r&&r.solid?r.solid.color:a}t.getValue=e,t.getFillColorByPropertyName=i}(e=t.DataViewObject||(t.DataViewObject={}))}(e=t.dataview||(t.dataview={}))}(e=t.utils||(t.utils={}))}(e=t.extensibility||(t.extensibility={}))}(powerbi||(powerbi={}));var powerbi;!function(t){var e;!function(t){var e;!function(t){var e;!function(t){var e;!function(e){function i(e,i,a){return e?t.DataViewObject.getValue(e[i.objectName],i.propertyName,a):a}function a(t,e,i){return t&&t[e]?t[e]:i}function r(t,e,a){var r=i(t,e);return r&&r.solid?r.solid.color:a}function n(t,e,a){var r=i(t,e,a);return r&&r.solid?r.solid.color:void 0===r||null===r||\"object\"==typeof r&&!r.solid?a:r}e.getValue=i,e.getObject=a,e.getFillColor=r,e.getCommonValue=n}(e=t.DataViewObjects||(t.DataViewObjects={}))}(e=t.dataview||(t.dataview={}))}(e=t.utils||(t.utils={}))}(e=t.extensibility||(t.extensibility={}))}(powerbi||(powerbi={}));var powerbi;!function(t){var e;!function(e){var i;!function(e){var i;!function(e){var i,a=t.extensibility.utils.dataview.DataRoleHelper;!function(t){function e(t,e,i){if(t.categories&&t.categories.length>0){var r=t.categories[0];return r.source&&a.hasRole(r.source,e)&&a.hasRole(r.source,i)}return!1}function i(t){return void 0!==t.groupName?t.groupName:t.queryName}function r(t){var e=s(t);return null!=e&&e.imageUrl===!0}function n(t){var e=s(t);return null!=e&&e.webUrl===!0}function s(t){return t&&t.type&&t.type.misc}function o(t){return t&&t.metadata&&t.metadata.columns&&t.metadata.columns.length?t.metadata.columns.some(function(t){return r(t)===!0}):!1}t.categoryIsAlsoSeriesRole=e,t.getSeriesName=i,t.isImageUrlColumn=r,t.isWebUrlColumn=n,t.getMiscellaneousTypeDescriptor=s,t.hasImageUrlColumn=o}(i=e.converterHelper||(e.converterHelper={}))}(i=e.dataview||(e.dataview={}))}(i=e.utils||(e.utils={}))}(e=t.extensibility||(t.extensibility={}))}(powerbi||(powerbi={}));var powerbi;!function(t){var e;!function(t){var e;!function(t){var e;!function(t){var e=function(){function e(){}return e.getDefault=function(){return new this},e.createPropertyIdentifier=function(t,e){return{objectName:t,propertyName:e}},e.parse=function(e){var i,a=this.getDefault();if(!e||!e.metadata||!e.metadata.objects)return a;i=a.getProperties();for(var r in i)for(var n in i[r]){var s=a[r][n];a[r][n]=t.DataViewObjects.getCommonValue(e.metadata.objects,i[r][n],s)}return a},e.isPropertyEnumerable=function(t){return!e.InnumerablePropertyPrefix.test(t)},e.enumerateObjectInstances=function(t,e){var i=t&&t[e.objectName];if(!i)return[];var a={objectName:e.objectName,selector:null,properties:{}};for(var r in i)i.hasOwnProperty(r)&&(a.properties[r]=i[r]);return{instances:[a]}},e.prototype.getProperties=function(){var t=this,i={},a=Object.keys(this);return a.forEach(function(a){if(e.isPropertyEnumerable(a)){var r=Object.keys(t[a]);i[a]={},r.forEach(function(t){e.isPropertyEnumerable(a)&&(i[a][t]=e.createPropertyIdentifier(a,t))})}}),i},e}();e.InnumerablePropertyPrefix=/^_/,t.DataViewObjectsParser=e}(e=t.dataview||(t.dataview={}))}(e=t.utils||(t.utils={}))}(e=t.extensibility||(t.extensibility={}))}(powerbi||(powerbi={}));var d3=window.d3,__extends=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function a(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(a.prototype=i.prototype,new a)}}(),powerbi;!function(t){var e;!function(e){var i;!function(e){var i;!function(e){\"use strict\";var i=t.extensibility.utils.dataview.DataViewObjectsParser,a=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.dataDisplay=new r,e.dataOption=new n,e}return __extends(e,t),e}(i);e.VisualSettings=a;var r=function(){function t(){this.backColor=\"#D3D3D3\",this.fill=\"#16B1E6\",this.bar_height=30,this.horizontal_margin=30,this.realisation_text=\"Réalisation\",this.resteafaire_text=\"Reste à faire\",this.ptpassage_text=\"Point de passage\",this.ptpassage_color=\"#9c27b0\",this.objectif_text=\"Objectif:\",this.objectif_color=\"#1b5e20\"}return t}();e.dataDisplaySettings=r;var n=function(){function t(){this.ptPassage=!0,this.prctMode=!1,this.prctMultiPlicateur=!1,this.calculAuto=!1}return t}();e.dataOptionSettings=n}(i=e.pbiflatprogress111DDC2C0F0D0384236A63C11C134C5CDB5||(e.pbiflatprogress111DDC2C0F0D0384236A63C11C134C5CDB5={}))}(i=e.visual||(e.visual={}))}(e=t.extensibility||(t.extensibility={}))}(powerbi||(powerbi={}));var powerbi;!function(t){var e;!function(t){var e;!function(t){var e;!function(t){\"use strict\";var e=function(){function t(t){this.element=t,this.data={},this.getvalue=function(t,e){return t[e]&&\"function\"==typeof t[e]?t[e]():t[e]},t.attributes;for(var e=t.querySelectorAll(\"*\"),i=0;i<e.length;i++)e[i].id&&(this.data[e[i].id]=e[i])}return t.prototype.update=function(t){var e=this;t.forEach(function(t){var i=e.data[t.id],a=!1;if(void 0!==t.visible?(i.style.visibility=e.getvalue(t,\"visible\")?\"visible\":\"collapse\",a=!0):a=!0,a){if(void 0!==t.value){var r=e.getvalue(t,\"value\");i.innerHTML=r?String(r):\"\"}if(void 0!==t.attr)for(var n in t.attr){var s=e.getvalue(t.attr,n);e.getvalue(t.attr,n)?i.setAttribute(n,s):i.removeAttribute(n)}if(void 0!==t.style)for(var o in t.style){var s=e.getvalue(t.style,o);i.style[o]=s?s:\"\"}}})},t}();t.DomEngine=e}(e=t.pbiflatprogress111DDC2C0F0D0384236A63C11C134C5CDB5||(t.pbiflatprogress111DDC2C0F0D0384236A63C11C134C5CDB5={}))}(e=t.visual||(t.visual={}))}(e=t.extensibility||(t.extensibility={}))}(powerbi||(powerbi={}));var powerbi;!function(t){var e;!function(t){var e;!function(t){var e;!function(t){\"use strict\";var e=function(){function e(e){this.visual_top=document.createElement(\"div\"),this.visual_top.className=\"visual_top\",e.element.appendChild(this.visual_top);var i='\\n                <div class=\"container\">\\n                    <div class=\"left_container\">\\n                        <div class=\"current_value_container\">\\n                            <div id=\"current_value_libelle\" class=\"current_value_libelle\"></div>\\n                            <div id=\"current_value\" class=\"current_value\"></div>\\n                        </div>\\n                        <div id=\"percent_value\" class=\"percent_value\"></div>\\n                    </div>\\n                    <div class=\"right_container\">\\n                        <div id=\"reste_value\" class=\"reste_value\"></div>\\n                        <div id=\"reste_legend\" class=\"reste_legend\"></div>\\n                    </div>\\n                </div>\\n                <svg id=\"svg\">\\n                    <rect id=\"back_rectangle\"></rect>\\n                    <rect id=\"front_rectangle\"></rect>\\n                    <line id=\"objectif_rectangle\" width=\"3\" y1=\"0\" stroke-width=\"1\"></line>\\n                    <text id=\"zero_text\" text-anchor=\"right\">0</text>\\n                    <polygon id=\"objectif_triangle\" points=\"0 0,7 10,-7 10\"></polygon>\\n                    <text id=\"objectif_text\"></text>\\n                    <line id=\"ptpassage_rectangle\" y1=\"0\" stroke-width=\"3\" stroke-dasharray=\"5,5\"></line>\\n                </svg>\\n                <div id=\"ptpassage_container\" class=\"ptpassage_container\">\\n                    <div id=\"ptpassage_value\" class=\"ptpassage_value\"></div>\\n                    <div id=\"ptpassage_legend\" class=\"ptpassage_legend\"></div>\\n                </div>\\n            ';this.visual_top.innerHTML=i,this.engine=new t.DomEngine(this.visual_top)}return e.prototype.update=function(t){this.settings=e.parseSettings(t&&t.dataViews&&t.dataViews[0]),this.visual_top.setAttribute(\"style\",\"height:\"+t.viewport.height+\"px;margin: 0 \"+this.settings.dataDisplay.horizontal_margin+\"px\");var i=this.visual_top.clientWidth,a=36,r=this.settings,n=e.getvalue(t.dataViews[0].categorical,\"measure\"),s=e.getvalue(t.dataViews[0].categorical,\"objectif_measure\"),o=+e.getvalue(t.dataViews[0].categorical,\"pt_passage_measure\"),l=+e.getvalue(t.dataViews[0].categorical,\"todo_measure\"),u=+e.getvalue(t.dataViews[0].categorical,\"prct_measure\");if(!u&&s&&(u=n/s*100),!l&&0!==l){var c=s-n;l=0>c?0:c}console.log(l);var v=i-10*i/100,p=0,f=0;n>s?(p=v,f=s/n*v):(p=u/100*v,f=v);var d=o/s*f,g=[{id:\"current_value_libelle\",visible:!!this.settings.dataDisplay.realisation_text,value:this.settings.dataDisplay.realisation_text},{id:\"current_value\",visible:!!n,value:function(){return n?(+n).toLocaleString():void 0}},{id:\"percent_value\",visible:!!u,value:function(){return u?(+u).toFixed(0).toLocaleString()+\"%\":void 0}},{id:\"reste_legend\",visible:!(!this.settings.dataDisplay.resteafaire_text||!l&&0!==l),value:this.settings.dataDisplay.resteafaire_text},{id:\"reste_value\",visible:!!l||0===l,value:function(){return l||0===l?(+l).toLocaleString():void 0}},{id:\"svg\",attr:{width:i,height:this.settings.dataDisplay.bar_height+a}},{id:\"back_rectangle\",attr:{width:i,height:this.settings.dataDisplay.bar_height,fill:this.settings.dataDisplay.backColor}},{id:\"front_rectangle\",attr:{width:p,height:this.settings.dataDisplay.bar_height,fill:this.settings.dataDisplay.fill}},{id:\"zero_text\",visible:f>15,attr:{y:this.settings.dataDisplay.bar_height+16}},{id:\"objectif_rectangle\",visible:!!s,attr:{x1:f,x2:f,y2:this.settings.dataDisplay.bar_height,stroke:this.settings.dataDisplay.objectif_color}},{id:\"objectif_triangle\",visible:!!s,attr:{transform:function(){return\"translate(\"+f+\",\"+(r.dataDisplay.bar_height+2)+\")\"},fill:this.settings.dataDisplay.objectif_color}},{id:\"objectif_text\",visible:!!s,value:function(){return s?r.dataDisplay.objectif_text+\" \"+s.toLocaleString():void 0},attr:{\"text-anchor\":100>f?\"right\":\"middle\",fill:this.settings.dataDisplay.objectif_color,x:f,y:this.settings.dataDisplay.bar_height+a-4}},{id:\"ptpassage_rectangle\",visible:this.settings.dataOption.ptPassage&&o,attr:{y2:this.settings.dataDisplay.bar_height+a,x1:d,x2:d,stroke:this.settings.dataDisplay.ptpassage_color}},{id:\"ptpassage_value\",visible:this.settings.dataOption.ptPassage&&o,value:function(){return o?o.toLocaleString():void 0}},{id:\"ptpassage_legend\",visible:this.settings.dataOption.ptPassage&&o,value:this.settings.dataDisplay.ptpassage_text},{id:\"ptpassage_container\",style:{color:this.settings.dataDisplay.ptpassage_color,\"margin-left\":function(){var t=d-75;return t=0>t?0:t,t=t>i-75?i-150:t,t+\"px\"}}}];this.engine.update(g)},e.parseSettings=function(e){return t.VisualSettings.parse(e)},e.getvalue=function(t,e){var i=t.values.filter(function(t){return t.source.roles[e]}).map(function(t){return t.values[0]});return i&&1===i.length?i[0]:void 0},e.prototype.enumerateObjectInstances=function(e){return t.VisualSettings.enumerateObjectInstances(this.settings||t.VisualSettings.getDefault(),e)},e}();t.Visual=e}(e=t.pbiflatprogress111DDC2C0F0D0384236A63C11C134C5CDB5||(t.pbiflatprogress111DDC2C0F0D0384236A63C11C134C5CDB5={}))}(e=t.visual||(t.visual={}))}(e=t.extensibility||(t.extensibility={}))}(powerbi||(powerbi={}));var powerbi;!function(t){var e;!function(e){var i;!function(e){e.pbiflatprogress111DDC2C0F0D0384236A63C11C134C5CDB5={name:\"pbiflatprogress111DDC2C0F0D0384236A63C11C134C5CDB5\",displayName:\"flatprogress\",\"class\":\"Visual\",version:\"1.0.0\",apiVersion:\"1.11.0\",create:function(e){return new t.extensibility.visual.pbiflatprogress111DDC2C0F0D0384236A63C11C134C5CDB5.Visual(e)},custom:!0}}(i=e.plugins||(e.plugins={}))}(e=t.visuals||(t.visuals={}))}(powerbi||(powerbi={}));","css":".visual-pbiflatprogress111DDC2C0F0D0384236A63C11C134C5CDB5 .visual_top{display:flex;flex-direction:column;justify-content:center}.visual-pbiflatprogress111DDC2C0F0D0384236A63C11C134C5CDB5 .container{display:flex;justify-content:space-between;margin-bottom:4px}.visual-pbiflatprogress111DDC2C0F0D0384236A63C11C134C5CDB5 .left_container{display:flex;align-items:baseline;align-items:flex-end}.visual-pbiflatprogress111DDC2C0F0D0384236A63C11C134C5CDB5 .current_value_container{display:flex;flex-direction:column}.visual-pbiflatprogress111DDC2C0F0D0384236A63C11C134C5CDB5 .current_value{font-size:61px}.visual-pbiflatprogress111DDC2C0F0D0384236A63C11C134C5CDB5 .right_container{display:flex;flex-direction:column;justify-content:center;align-items:center}.visual-pbiflatprogress111DDC2C0F0D0384236A63C11C134C5CDB5 .percent_value{margin-left:16px;font-size:25px;margin-bottom:8px}.visual-pbiflatprogress111DDC2C0F0D0384236A63C11C134C5CDB5 .reste_value{fill:#333;font-family:wf_standard-font,helvetica,arial,sans-serif;font-size:36px}.visual-pbiflatprogress111DDC2C0F0D0384236A63C11C134C5CDB5 .ptpassage_container{width:150px;text-align:center}.visual-pbiflatprogress111DDC2C0F0D0384236A63C11C134C5CDB5 .ptpassage_value{font-family:wf_standard-font,helvetica,arial,sans-serif;font-size:36px}.visual-pbiflatprogress111DDC2C0F0D0384236A63C11C134C5CDB5 .reste_legend,.visual-pbiflatprogress111DDC2C0F0D0384236A63C11C134C5CDB5 .ptpassage_legend,.visual-pbiflatprogress111DDC2C0F0D0384236A63C11C134C5CDB5 .current_value_libelle{font-size:16px}","iconBase64":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAD5JREFUeNpiYBhxgBFK/ycgT3cD/5PrAMIuFNv47D8lBuxVeovCZ6K2C0cNHIQGDhj4jyc3DQ4DRwFuABBgAPyFC4TULc3MAAAAAElFTkSuQmCC"}}